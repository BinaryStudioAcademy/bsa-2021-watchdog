<div class="title">
    <div>
        Issues
    </div>
</div>
<div class="issues-content">
    <p-tabView styleClass="tabview-custom">

        <div class="functional-bar">
            <div class="search-block p-inputgroup">
                <span class="p-inputgroup-addon search-button"><i class="pi pi-search"></i></span>
                <input name="search" pInputText placeholder="Search" type="text"
                    (input)="table.filterGlobal({value: $event.target.value, fields: globalFilterFields }, 'contains')">
            </div>
            <!-- <div class="action-block">
               <span class="p-inputgroup-addon search-button"><i class="pi pi-paperclip"></i></span>
               <span class="p-inputgroup-addon search-button"><i class="pi pi-plus"></i></span>
               <span class="p-inputgroup-addon search-button"><i class="pi pi-ellipsis-v"></i></span>
               <span class="p-inputgroup-addon search-button"><i class="pi pi-times"></i></span>
           </div> -->
        </div>

        <p-tabPanel>
            <ng-template pTemplate="header">
                <div class="header">
                    <span>All Unresolved</span>
                    <p-badge *ngIf="totalRecords > 0" [value]="totalRecords.toString()"></p-badge>
                </div>
            </ng-template>

            <p-table #table [autoLayout]="true" [paginator]="issues?.length > itemsPerPage" [resizableColumns]="true"
                [rows]="itemsPerPage" [value]="issues" class="issues-table" [lazy]="true"
                (onLazyLoad)="loadIssuesLazy($event)" [totalRecords]="totalRecords" [loading]="loading">
                <ng-template pTemplate="colgroup">
                    <colgroup>
                        <col id="issue-col">
                        <col id="events-col">
                        <col id="users-col">
                        <col id="assignee-col">
                    </colgroup>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th class="name" pSortableColumn="newest.occurredOn">
                            <div class="issue">
                                <p-checkbox name="allIssues" (onChange)="selectAll($event)"></p-checkbox>
                                <span>Issue <p-sortIcon field="newest.occurredOn"></p-sortIcon>
                                </span>
                                <p-columnFilter [showAddButton]="false" [showOperator]="false" type="text"
                                    field="errorClass" display="menu">
                                </p-columnFilter>
                            </div>
                        </th>
                        <th class="center" pSortableColumn="eventsCount">
                            <span>Events <p-sortIcon field="eventsCount">
                                </p-sortIcon>
                            </span>
                        </th>
                        <th class="center" pSortableColumn="affected">
                            <span>Affected <p-sortIcon field="affected">
                                </p-sortIcon>
                            </span>
                        </th>
                        <th class="center"><span>Assignee</span></th>
                    </tr>
                </ng-template>
                <ng-template let-issue pTemplate="body">
                    <tr>
                        <td>
                            <div class="issue-block">
                                <p-checkbox [(ngModel)]="selectedIssues" [value]="issue" name="selectedIssues">
                                </p-checkbox>
                                <div class="content">
                                    <span class="name"
                                        routerLink="/home/issues/{{issue.issueId}}/{{issue.newest.id}}">{{issue.errorClass}}</span>
                                    <span class="description">{{issue.errorMessage}}</span>
                                    <div class="additional-info">
                                        <p-tag *ngIf="issue.isNew" [rounded]="true" class="new-issue"
                                            styleClass="p-mr-2" value="New issue">
                                        </p-tag>
                                        <span>{{issue.projectTag}}</span>
                                        <div class="tooltip">
                                            <span><i class="pi pi-clock time-icon"></i>{{issue.newest.occurredOn |
                                                timeAgo}}</span>
                                            <span class="tooltiptext">{{issue.newest.occurredOn | date:'MMMM d, y
                                                h:mma'}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>{{issue.eventsCount}}</td>
                        <td>{{issue.affected}}</td>
                        <td>
                            <div class="assignee" (click)="openAssign(issue)">
                                <p-avatarGroup styleClass="p-mb-3">
                                    <p-avatar *ngIf="getNumberAssignee(issue?.assignee) === 0" icon="pi pi-user"
                                        shape="circle"></p-avatar>
                                    <p-avatar *ngFor="let img of getMembersImages(issue?.assignee)" [image]="img"
                                        shape="circle"></p-avatar>
                                    <p-avatar *ngFor="let label of getTeamsLabels(issue?.assignee)" [label]="label"
                                        shape="circle"></p-avatar>
                                    <p-avatar *ngIf="getNumberAssignee(issue?.assignee) > 3"
                                        [label]="getNumberExtraAssignee(issue?.assignee)" shape="circle"></p-avatar>
                                </p-avatarGroup>
                                <i class="pi pi-chevron-down"></i>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>

        </p-tabPanel>
        <p-tabPanel [cache]="false" [disabled]="true">
            <ng-template pTemplate="header">
                <div class="header">
                    <span>Second Type</span>
                    <p-badge *ngIf="issuesCount.secondtype > 0" [value]="issuesCount.secondtype.toString()"></p-badge>
                </div>
            </ng-template>
        </p-tabPanel>
        <p-tabPanel [disabled]="true">
            <ng-template pTemplate="header">
                <div class="header">
                    <span>Third Type</span>
                    <p-badge *ngIf="issuesCount.thirdtype > 0" [value]="issuesCount.thirdtype.toString()"></p-badge>
                </div>
            </ng-template>
        </p-tabPanel>
    </p-tabView>
</div>
<app-assignee (closeModal)="closeAssing()" [data]="toAssing" [members]="sharedOptions.members"
    [teams]="sharedOptions.teams" *ngIf="isAssign">
</app-assignee>